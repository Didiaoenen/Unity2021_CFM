local IInteractionRequest = require("LuaFramework.Interactivity.IInteractionRequest")
local InteractionEventArgs = require("LuaFramework.Interactivity.InteractionEventArgs")
local TableOprationMode = require("LuaFramework.Binding.TableOprationMode")
local MapExtention = require("LuaFramework.Common.MapExtention")

local InteractionRequest = class("InteractionRequest", IInteractionRequest)

function InteractionRequest.opt:Raised(value)
   if value.opt == TableOprationMode.Add then
      self.raised[value.save] = value
   end

   if value.opt == TableOprationMode.Remove then
      self.raised[value.save] = nil
   end
end

function InteractionRequest.get:Raised()
   return self.raised
end

function InteractionRequest:ctor(sender)
   self.sender = sender or (self)
   self.raised = {}
end

function InteractionRequest:Raise(context, callback)
   MapExtention.Foreach(self.raised, function(_, v)
      v.callback(v.this, self.sender, InteractionEventArgs.new(context, function()
         if callback then
            callback(context)
         end
      end))
   end)
end

function InteractionRequest:dtor()
end

return InteractionRequest
