local Transition = require("LuaFramework.Views.Transition")

local TransitionShow = class("TransitionShow", Transition)

function TransitionShow:ctor(manager, window)
    Transition.ctor(self, window)
    self.manager = manager
end

function TransitionShow:Overlay(previous, current)
    if previous.WindowType == WindowType.FULL then
        return ActionType.Hide
    end

    if previous.WindowType == WindowType.POPUP then
        return ActionType.Dismiss
    end

    return ActionType.None
end

function TransitionShow:DoTransition()
    Transition.DoTransition(self)
    local current = self.window

    local previous = nil
    if current.windowType == WindowType.NONE then
        WindowManager.Current:AddSubView(current)
    elseif current.windowType == WindowType.FULL then
        previous = WindowManager:PushWindowStack(current)
    elseif current.windowType == WindowType.POPUP or window.windowType == WindowType.DIALOG then
        previous = WindowManager.Current:PushOpenView(current)
    end

    if previous then
        local policy = self.OverlayPolicy
        if not policy then
            policy = self.Overlay
        end

        local actionType = policy(self, previous, current)
        if actionType == ActionType.Hide then
            local hide = previous:DoHide(self.AnimationDisabled)
            Coroutine.Yield(hide:WaitForDone())
        elseif actionType == ActionType.Dismiss then
            local hide = previous:DoHide(self.AnimationDisabled)
            Coroutine.Yield(hide:WaitForDone())
            previous:DoDismiss()
        end
    end

    if not current.Visibility then
        local show = current:DoShow(self.AnimationDisabled)
        Coroutine.Yield(show:WaitForDone())
    end
end

function TransitionShow:dtor()
    
end

return TransitionShow